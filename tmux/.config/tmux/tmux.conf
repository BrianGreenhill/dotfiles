# Better terminal type
set-option -g default-terminal "tmux-256color"
set-option -a terminal-features 'tmux-256color:RGB'

# No delay for escape key
set -sg escape-time 0

# Status bar at top
set-option -g status-position top

# Better prefix
set -g prefix C-a
unbind C-b
bind C-a send-prefix

# Start indexing at 1
set -g base-index 1
set -g pane-base-index 1
set -g renumber-windows on
setw -g pane-base-index 1

# Splits keep current directory
bind '"' split-window -h -c "#{pane_current_path}"
bind % split-window -v -c "#{pane_current_path}"
bind c new-window -c "#{pane_current_path}"

# Vim pane navigation
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Resize panes
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Mouse support
set -g mouse on

# Vi mode in copy mode
setw -g mode-keys vi
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel

# Passthrough support
set -g allow-passthrough on

# Update environment variables
set -ga update-environment TERM
set -ga update-environment TERM_PROGRAM

# Plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-sessionist'

# Manual save/restore (prefix + Ctrl-s to save, prefix + Ctrl-r to restore)
set -g @resurrect-strategy-nvim 'session'

# Clean status bar with Kanagawa colors
set -g status-position top
set -g status-justify left
set -g status-style 'fg=#c5c9c5 bg=#181616'
set -g status-left '#[fg=#7fb4ca,bold] #{session_name} '
set -g status-left-length 30
set -g status-right '#[fg=#8a9a7b]#{b:pane_current_path} #[fg=#c34043]%H:%M '
set -g status-right-length 50

# Current window style
setw -g window-status-current-style 'fg=#181616 bg=#c34043 bold'
setw -g window-status-current-format ' #I:#W#F '

# Inactive window style
setw -g window-status-style 'fg=#8a9a7b dim'
setw -g window-status-format ' #I:#W#F '

# Message style
set -g message-style 'fg=#c34043 bg=#181616 bold'

# Pane borders
set -g pane-border-style 'fg=#54546D'
set -g pane-active-border-style 'fg=#c34043'

# Bell style
setw -g window-status-bell-style 'fg=#c34043 bg=#181616 bold'

# Auto-install TPM if not present
if "test ! -d ~/.config/tmux/plugins/tpm" \
   "run 'git clone https://github.com/tmux-plugins/tpm ~/.config/tmux/plugins/tpm && ~/.config/tmux/plugins/tpm/bin/install_plugins'"

# Initialize TPM (keep this at the very bottom)
run '~/.config/tmux/plugins/tpm/tpm'
